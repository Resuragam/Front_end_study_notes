## 浏览器事件机制

### 1. 事件是什么？事件模型？

事件是用户操作的网页的交互动作，比如`click`、`move`，也可以是浏览器文档加载，窗口滚动和大小调整。事件被封装成一个`event`对象，包含了事件触发时的相关信息以及对事件进行的操作。

现代浏览器一共有三种事件模型：

* **DOM0级事件模型**，这种模型不会传播，所以没有事件流的概念，它在网页中直接定义监听函数，也可以通过`JavaScript`属性绑定监听函数。
* **IE事件模型**，在该事件模型中，包括事件处理阶段和事件冒泡阶段。事件处理阶段会首先执行目标元素绑定的监听事件。然后是事件冒泡阶段，事件冒泡会将事件从目标元素传播到`document`元素，依次检查经过的节点是否绑定了监听函数并且执行。该事件模型通过`attachEvenet`方法添加监听函数。
* **DOM2级事件模型**，这种事件模型包括事件捕获阶段，事件处理阶段和事件冒泡阶段。在事件捕获阶段是指事件会从`document`元素向下传播到目标元素。事件处理阶段会首先执行目标元素绑定的监听事件。然后是事件冒泡阶段，事件冒泡会将事件从目标元素传播到`document`元素，依次检查经过的节点是否绑定了监听函数并且执行。该事件模型通过`addEventListener`方法添加监听函数。

### 2. 如何阻止事件冒泡

普通浏览器：`e.stopPropagation()`

IE浏览器：`event.cancelBubble = true`

### 3. 对事件委托的理解

事件委托的本质是利用事件冒泡机制。因为事件在冒泡阶段会传播至上层节点，父节点可以获取到通过事件对象获取到目标节点，因此子节点的监听函数可以定义到父节点上。父节点的监听函数统一处理多个子元素的事件，被称为事件委托。

事件委托的优势：

* 减少内存的消耗将监听事件绑定在目标元素的父层元素上，可以减少内存消耗，节约效率。
* 动态绑定事件：避免子元素的增加或删除需要动态的绑定或者解绑监听事件。

### 4. 同步和异步的区别

**同步**是指某个进程执行一个请求，如果这个请求需要等待一段时间才能返回，那个这个进程会一直等待下去，知道消息返回才进行向下执行。

**异步**是指某个进程执行一个请求时，如果这个请求需要等待一段时间才能返回，那么这个进程会继续执行下去，不会阻塞等待消息的返回，当消息返回时系统在通知进程进行处理。

### 5. 对事件循环的理解

因为`JavaScript`是单线程的，在代码执行的时候，通过将不同函数的执行上下文压入执行栈中，保证代码的有序进行。在执行同步代码时，如果遇到异步事件，js引擎并不会一直等待返回其结果，而是将这个任务挂起，继续执行执行栈中的任务直到执行完毕。当异步事件执行完毕后，再将异步任务的回调函数加入到一个任务队列当中等待执行。任务队列可以分为宏任务队列和微任务队列。当当前的执行栈执行完成后，会首先判断微任务队列中是否有任务需要执行，如果有就将微任务中的事件压入执行栈中执行，等全部微任务执行完成后再次执行宏任务。循环往复的过程被称为事件循环。

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/426a3bf11f404821abb636690119621b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

`Event Loop `执行顺序如下所示：

* 首先执行同步代码，属于宏任务。
* 当执行完所有同步任务后，执行站为空，检查是否有异步任务需要执行。
* 执行所有微任务。
* 当执行完微任务后，如果必要会重新渲染页面。
* 进入下一轮`Event Loop `，执行宏任务中的异步代码。

### 6. 宏任务和微任务分别有哪些

宏任务：`Promise`的回调，对`DOM`变化监听的`MutationObserver`。

微任务：`script`脚本执行，`AJAX`请求，定时器任务，`I/O`操作。