## 懒加载

### 1. 懒加载的概念

懒加载也被称为延迟加载、按需加载，指在长网页中延迟加载图片数据，是一种较好的网页性能优化方式。在较长的网页和应用中，如果图片很多，但是一次性加载完成，但是用户只能看到可视窗口的图片，就浪费了性能。

如果使用图片懒加载就可以解决一下问题。在滚动屏幕之前，可视化区域的图片不会进行加载，在滚动屏幕之后才加载。这样子可以提高服务器的加载速度，减少服务器的负载。懒加载适合图片较多的页面，页面列表较长的场景中。

### 2. 懒加载的特点

* **减少无用资源的加载：**使用懒加载可以减少非可视区域数据的加载，减少服务器和浏览器的负担。
* **提高用户体验：**如果同时加载太多图片，可能等待的时间会较长，从而影响用户体验。
* **防止加载图片过多影响加载其他资源：**减少图片资源的加载。

### 3. 懒加载的实现原理

图片的加载是由`src`引起的，当对`src`赋值时，浏览器就会请求图片资源。

因此我们可以通过`HTML5`中的`data-src`属性存储图片的路径值，当图片出现在可视区域时，在进行`src`属性的赋值。

**可视区域的计算：**

* `window.innerHeight`属性获取浏览器的可视高度。
* `document.body.scrollTop`获取浏览器滚动的高度。
* `img.offsetTop`获取元素距离文档顶部的高度。
* `document.body.scrollTop` + `window.innerHeight` > `img.offsetTop`

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efbcb31418be45eaa848d107b107c4eb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 4. 懒加载与预加载的区别

懒加载和预加载都可以提高网页的性能。懒加载是延迟加载甚至不加载，而预加载是提前加载。懒加载对服务器资源有一定缓解压力的作用，而预加载会增加服务器的压力。

* **懒加载**被称为延迟加载，当数据和图片资源到达可视化区域后再进行加载，可以提高网页的首屏加载速度，提升用户体验，减少服务器的压力。
* **预加载**是指将所需的资源提前发送到加载到本地，会一定程度上增加服务器的压力。通过预加载能够减少用户的等待时间，提高用户的体验。我了解的预加载的最常用的方式是使用 `JavaScript` 中的 `image` 对象，通过为 `image` 对象来设置 `scr` 属性，来实现图片的预加载。