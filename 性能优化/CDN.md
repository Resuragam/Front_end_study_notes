## CDN

### 1. CDN的概念

CDN是内容分发网络，是一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更加可靠的将音乐、图片、视频、应用程序以及其他文件发送给用户，来提供高性能，可扩展性和低成本网络内容传递给用户。

典型的CDN系统由下面三个部分组成：

* **分发服务系统：**最基本的工作单位就是Cache，Cache负责直接响应最终用户的访问请求，把缓存在本地的内容快速提供给用户。同时cache还负责与源站点进行内容同步，把更新的内容以及本地没有内容从源站点获取保存到本地。
* **负载均衡系统：**主要功能就是负责对所有发起服务请求的用户进行访问调度，确定提供给用户最终的访问地址。两级调度体系分为全局负载均衡和本地负载均衡。全局负载均衡主要根据用户的就近原则，通过对每个节点进行最优判断，确定向用户提供服务的cache的物理地址。**本地负载均衡**主要负责节点内部的设备负载均衡。
* **运营管理系统：**运营管理系统分为运营管理和网络管理子系统，负责处理业务层面的与外界系统交互所必须的收集、整理、交付工作，包含客户管理、产品管理、计费管理、统计分析等功能。

### 2. CDN的作用

CDN一般会用来托管Web资源，可供下载的资源，应用程序。使用CDN来加速这些资源的访问速度。

**性能方面：**

* 用户收到的内容来自最近的数据中心，延迟更低，加载数据更快。
* 分布资源分配给了服务器，减少了服务器的负载。

**在安全方面：**

* 针对DDoS：通过监控分析异常流量，限制其请求频率。
* 针对MITM：从源服务器到CDN节点到ISP，全链路HTTPS通信。

### 3. CDN的原理

* 对于点击的URL，经过本地DNS服务器解析，发现该URL指向一个CDN专用的DNS服务器，DNS系统会将域名解析权交给CDN DNS服务器。
* CDN DNS专用服务器会返回一个CDN全局负载均衡服务器的IP地址给用户。
* 用户向CDN全局负载均衡设备发送请求。
* CDN全局负载均衡设备会根据用户的IP地址，找到他所在区域的CDN区域负载均衡设备IP地址，CDN区域负载均衡设备会根据IP地址，选择合适的CDN缓存服务器，并且返回IP地址给全局CDN负载均衡设备，再返回给用户。
* 用户向CDN缓存服务器发送请求，获取资源。

如果缓存服务器没有用户想要的内容，那么缓存服务器就会向它的上一级缓存服务器请求内容，以此类推，直到获取到需要的资源。最后如果还是没有，就会回到自己的服务器去获取资源。

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4635b395fb64aaab8417f63e64291d4~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

### 4. CDN的使用场景

* **使用第三方CDN服务：**如果想要进行开源服务，可以使用第三方的CDN服务。
* **使用CDN进行缓存：**将自己网站的静态资源放在CDN上，比如js、css、图片等。可以将整个项目放在CDN上，完成一键部署。
* **直播传送：**直播的本质是进行流媒体传送，CDN支持流媒体的传送，直播可以通过CDN来提高访问效率。